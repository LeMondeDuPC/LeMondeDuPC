{% extends 'base.html.twig' %}

{% block title %}{{ product.title }}{% endblock %}

{% block description %}{{ product.description }}{% endblock %}

{% block image %}{% if product.file is not null %}{{ app.request.getSchemeAndHttpHost() }}{{ asset(product.file.getWebPath) }}{% else %}{{ app.request.getSchemeAndHttpHost() }}{{ asset('assets/images/favicons/favicon-192x192.png') }}{% endif %}{% endblock %}

{% block body %}
    <article class="post">
        <header>
            <div class="title">
                <h1 class="heading">
                    {{ product.title }}
                </h1>
            </div>
            <div class="meta">
                <ul class="icons">
                    <li>
                        <time class="published icon fa-plus-square">{{ product.timePublication|date('Y-m-d H:i:s') }}</time>
                        {% if product.timeUpdate is not null %}
                            <time class="published icon fa-edit">{{ product.timeUpdate|date('Y-m-d H:i:s') }}</time>
                        {% endif %}
                    </li>
                </ul>
                <ul class="icons">
                    <li>
                        {% if product.user is not null %}
                            <a href="{{ path('user_show', {'id' : product.user.id}) }}" class="author">
                                <span class="icon fa fa-coins">{{ product.user.score }}</span>
                                <span class="name">{{ product.user.username }}</span>
                                {% if product.user.file is not null %}
                                    <img src="{{ asset(product.user.file.getWebPath) }}"
                                         alt="{{ product.user.file.description }}"/>
                                {% endif %}
                            </a>
                        {% else %}
                            <span class="author name">Anonyme</span>
                        {% endif %}
                    </li>
                </ul>
                <ul class="icons">
                    <li>
                        <a href="{{ path('vote_heart', {'id': product.id}) }}" class="icon fa-heart"
                           title="Ajouter dans ma liste d'article favoris">
                            <span>{{ product.hearts|length }}</span>
                        </a>
                    </li>
                </ul>
                <ul class="icons">
                    <li>
                        <a href="https://twitter.com/share?url={{ app.request.uri }}&text={{ product.title|slugify }}"
                           target="_blank" class="icon fa-twitter">
                            <span class="label">Twitter</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/sharer.php?u={{ app.request.uri }}&t={{ product.title|slugify }}"
                           target="_blank" class="icon fa-facebook">
                            <span class="label">Facebook</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ app.request.uri }}&title={{ product.title|slugify }}"
                           target="_blank" class="icon fa-linkedin">
                            <span class="label">LinkedIn</span>
                        </a>
                    </li>
                </ul>
                <ul class="icons">
                    <li>
                        {% if product.category is not null %}
                            <span class="item icon fa-tag"><a
                                        href="{{ path('category_show', {'id': product.category.id, 'name': product.category.name|slugify }) }}">{{ product.category.name }}</a></span>
                        {% else %}
                            <span class="item icon fa-tag">Non répertorié</span>
                        {% endif %}
                    </li>
                </ul>
            </div>
        </header>
        <section>
            {% if product.file is not null %}
                <img src="{{ asset(product.file.getWebPath) }}" alt="{{ product.file.description }}"
                     class="image featured"/>
            {% endif %}
            {{ product.content|raw }}
        </section>
        <hr/>
        <section>
            <h3>Dans la même catégorie :</h3>
            <div class="box alt">
                <div class="row gtr-uniform">
                    {% for related in product.category.getRelated(product)|reverse[0:6] %}
                        <div class="col-4">
                            <a class="image featured"
                               href="{{ path('product_show', {'id' : related.id, 'slug' : related.title|slugify }) }}">
                                {% if product.file is not null %}
                                    <img src="{{ asset(related.file.getWebPath) }}"
                                         alt="{{ related.file.description }}"/>
                                {% endif %}
                                <span>{{ related.title }}</span>
                            </a>
                        </div>
                    {% else %}
                        <p>Aucun autre article n'est disponible pour le moment dans cette catégorie</p>
                    {% endfor %}
                </div>
            </div>
        </section>
        <hr/>
        <section>
            <h3>Commentaires :</h3>
            <section>
                {{ render(controller('App\\Controller\\VoteController::newComment', {'product' : product})) }}
            </section>
            {% for vote in product.comments %}
                <article class="comment">
                    <header>
                        <div class="title">
                            <span>{{ vote.content }}</span>
                        </div>
                        <div class="meta">
                            <time class="published">{{ vote.timePublication|date('Y-m-d H:i:s') }}</time>
                            <a class="author"
                               href="{{ path('user_show', {'id': vote.user.id }) }}">
                                <span class="name">{{ vote.user.username }}</span>
                                {% if vote.user.file is not null %}
                                    <img src="{{ asset(vote.user.file.getWebPath) }}"
                                         alt="{{ vote.user.file.description }}"/>
                                {% endif %}
                            </a>
                            {% if app.user == vote.user %}
                                {{ include('vote/form/_comment_delete_form.html.twig') }}
                            {% endif %}
                        </div>
                    </header>
                </article>
            {% endfor %}
        </section>
    </article>
{% endblock %}
