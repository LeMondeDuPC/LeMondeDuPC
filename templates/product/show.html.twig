{% extends 'base.html.twig' %}

{% block title %}{{ product.title }}{% endblock %}

{% block description %}{{ product.description }}{% endblock %}

{% block body %}
    <article class="post">
        <header>
            <div class="title">
                <h1 class="heading">
                    {{ product.title }}
                </h1>
            </div>
            <div class="meta">
                <time class="published">{{ product.timePublication|date('Y-m-d H:i:s') }}</time>
                {% if product.user is not null %}
                    <a href="{{ path('user_show', {'id' : product.user.id}) }}" class="author">
                        <span class="name">{{ product.user.username }}</span>
                        {% if product.user.file is not null %}
                            <img src="{{ asset(product.user.file.getWebPath) }}"
                                 alt="{{ product.user.file.description }}"/>
                        {% endif %}
                    </a>
                {% else %}
                    <span class="author name">Anonyme</span>
                {% endif %}
                <ul class="icons">
                    <li>
                        <a href="{{ path('vote_heart', {'id': product.id}) }}" class="icon fa-heart"
                           title="Ajouter dans ma liste d'article favoris">
                            <span>{{ product.hearts|length }}</span>
                        </a>
                    </li>
                </ul>
                <ul class="icons">
                    <li>
                        <a href="https://twitter.com/share?url={{ app.request.uri }}&text={{ product.title|slugify }}"
                           target="_blank" class="icon fa-twitter">
                            <span class="label">Twitter</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/sharer.php?u={{ app.request.uri }}&t={{ product.title|slugify }}"
                           target="_blank" class="icon fa-facebook">
                            <span class="label">Facebook</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/share?url={{ app.request.uri }}&hl=fr"
                           target="_blank" class="icon fa-google-plus">
                            <span class="label">Google +</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ app.request.uri }}&title={{ product.title|slugify }}"
                           target="_blank" class="icon fa-linkedin">
                            <span class="label">LinkedIn</span>
                        </a>
                    </li>
                </ul>
                {% if product.category is not null %}
                    <span class="location icon fa-tag"><a
                                href="{{ path('category_show', {'id': product.category.id, 'name': product.category.name|slugify }) }}">{{ product.category.name }}</a></span>
                {% else %}
                    <span class="location icon fa-tag">Non répertorié</span>
                {% endif %}
            </div>
        </header>
        <section>
            <img src="{{ asset(product.file.getWebPath) }}" alt="{{ product.file.description }}"
                 class="image featured"/>
            {{ product.content|raw }}
        </section>
        <hr/>
        <section>
            <h3>Commentaires :</h3>
            <section>
                {{ render(controller('App\\Controller\\VoteController::newComment', {'product' : product})) }}
            </section>
            {% for comment in product.comments %}
                <article class="comment">
                    <header>
                        <div class="title">
                            <span>{{ comment.content }}</span>
                        </div>
                        <div class="meta">
                            <time class="published">{{ comment.timePublication|date('Y-m-d H:i:s') }}</time>
                            <a class="author"
                               href="{{ path('user_show', {'id': comment.user.id }) }}">
                                <span class="name">{{ comment.user.username }}</span>
                                {% if comment.user.file is not null %}
                                    <img src="{{ asset(comment.user.file.getWebPath) }}"
                                         alt="{{ comment.user.file.description }}"/>
                                {% endif %}
                            </a>
                            {% if app.user == comment.user %}
                                {{ include('vote/form/_comment_delete_form.html.twig') }}
                            {% endif %}
                        </div>
                    </header>
                </article>
            {% endfor %}
        </section>
    </article>
{% endblock %}
